<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.inst.project.admin.service.impl.AdminLoginMapper">
	
	<!--  로그인 관리자 조회 [S]-->
	<select id="selectAdminInfo" parameterType="AdminDTO" resultType="AdminDTO">
		/* AdminLogin_SQL.selectAdminInfo */
		SELECT ADMIN_NO
				  , ADMIN_ID
				  , ADMIN_PW
				  , ADMIN_NM
				  , ADMIN_POSITION_CD
				  , ADMIN_PH
				  , ADMIN_POST_CD
				  , ADMIN_ADDRESS
				  , ADMIN_D_ADDRESS
				  , ADMIN_DEL_YN
				  , ADMIN_DEPT_CD
				  , ADMIN_TEAM_CD
				  , ADMIN_CN
				  , ADMIN_GENDER
			 	  , ADMIN_REG_GB
		 		  , ADMIN_GRADE_CD
				  , ADMIN_REG_ACCEPT
				  , REG_ID
				  , REG_DT
				  , UPD_ID
				  , UPD_DT
		   FROM TB_ADMIN_INFO
	     WHERE ADMIN_ID = #{adminId}
	         AND ADMIN_DEL_YN = 'N'
	</select>
	<!--  로그인 관리자 조회 [E]-->
	
	<!--  로그인 관리자 정보 없음 저장 [S]-->
	<insert id="insertEmptyAdminLoginLog" parameterType="AdminDTO">
		/* AdminLogin_SQL.insertEmptyAdminLoginLog */
		INSERT INTO TB_ADMIN_LOGIN_LOG_INFO (
				   LOGIN_LOG_ID
			     , LOGIN_ADMIN_ID
			     , LOGIN_LOG_ADMIN_IP
			     , LOGIN_LOG_LOGIN_GB
			     , LOGIN_LOG_CN
			     , REG_DT
			     , UPD_DT 
		) VALUES (
				   ( SELECT FN_GET_UNIQUE_KEY() )
				 , #{adminId}
				 , #{adminIp}
				 , 'E'
				 , 'EMPTY'
				 , NOW()
				 , NOW()
		);
	</insert>
	<!--  로그인 관리자 정보 없음 저장 [E]-->
	
	<!--  로그인 관리자 가입 미승인 저장 [S]-->
	<insert id="insertNotAcceptAdminLoginLog" parameterType="AdminDTO">
		/* AdminLogin_SQL.insertNotAcceptAdminLoginLog */
		INSERT INTO TB_ADMIN_LOGIN_LOG_INFO (
				   LOGIN_LOG_ID
			     , LOGIN_ADMIN_ID
			     , LOGIN_LOG_ADMIN_IP
			     , LOGIN_LOG_LOGIN_GB
			     , LOGIN_LOG_CN
			     , REG_DT
			     , UPD_DT 
		) VALUES (
				   ( SELECT FN_GET_UNIQUE_KEY() )
				 , #{adminId}
				 , #{adminIp}
				 , 'NA'
				 , 'NOTACCEPT'
				 , NOW()
				 , NOW()
		);
	</insert>
	<!--  로그인 관리자 가입 미승인 저장 [E]-->
	
	<!--  로그인 관리자 가입 거부 저장 [S]-->
	<insert id="insertRejectAdminLoginLog" parameterType="AdminDTO">
		/* AdminLogin_SQL.insertRejectAdminLoginLog */
		INSERT INTO TB_ADMIN_LOGIN_LOG_INFO (
				   LOGIN_LOG_ID
			     , LOGIN_ADMIN_ID
			     , LOGIN_LOG_ADMIN_IP
			     , LOGIN_LOG_LOGIN_GB
			     , LOGIN_LOG_CN
			     , REG_DT
			     , UPD_DT 
		) VALUES (
				   ( SELECT FN_GET_UNIQUE_KEY() )
				 , #{adminId}
				 , #{adminIp}
				 , 'R'
				 , 'REJECT'
				 , NOW()
				 , NOW()
		);
	</insert>
	<!--  로그인 관리자 가입 거부 저장 [E]-->
	
	<!--  로그인 관리자 로그인 저장 [S]-->
	<insert id="insertAdminLoginLog" parameterType="AdminDTO">
		/* AdminLogin_SQL.insertAdminLoginLog */
		INSERT INTO TB_ADMIN_LOGIN_LOG_INFO (
				   LOGIN_LOG_ID
			     , LOGIN_ADMIN_ID
			     , LOGIN_LOG_ADMIN_IP
			     , LOGIN_LOG_LOGIN_GB
			     , LOGIN_LOG_CN
			     , REG_DT
			     , UPD_DT 
		) VALUES (
				   ( SELECT FN_GET_UNIQUE_KEY() )
				 , #{adminId}
				 , #{adminIp}
				 , 'Y'
				 , 'LOGIN'
				 , NOW()
				 , NOW()
		);
	</insert>
	<!--  로그인 관리자 로그인 저장 [E]-->
	
	<!--  관리자가 회원등록 비밀번호 초기설정 상태 [S]-->
	<insert id="insertPwSetAdminLoginLog" parameterType="AdminDTO">
		/* AdminLogin_SQL.insertPwSetAdminLoginLog */
		INSERT INTO TB_ADMIN_LOGIN_LOG_INFO (
				   LOGIN_LOG_ID
			     , LOGIN_ADMIN_ID
			     , LOGIN_LOG_ADMIN_IP
			     , LOGIN_LOG_LOGIN_GB
			     , LOGIN_LOG_CN
			     , REG_DT
			     , UPD_DT 
		) VALUES (
				   ( SELECT FN_GET_UNIQUE_KEY() )
				 , #{adminId}
				 , #{adminIp}
				 , 'PW'
				 , 'PWSET'
				 , NOW()
				 , NOW()
		);
	</insert>
	<!--  관리자가 회원등록 비밀번호 초기설정 상태 [E]-->
	
	<!--  로그인 관리자 로그인 실패 저장 [S]-->
	<insert id="insertLoginFailLog" parameterType="AdminDTO">
		/* AdminLogin_SQL.insertLoginFailLog */
		INSERT INTO TB_ADMIN_LOGIN_LOG_INFO (
				   LOGIN_LOG_ID
			     , LOGIN_ADMIN_ID
			     , LOGIN_LOG_ADMIN_IP
			     , LOGIN_LOG_LOGIN_GB
			     , LOGIN_LOG_CN
			     , REG_DT
			     , UPD_DT 
		) VALUES (
				   ( SELECT FN_GET_UNIQUE_KEY() )
				 , #{adminId}
				 , #{adminIp}
				 , 'N'
				 , 'LOGIN FAIL'
				 , NOW()
				 , NOW()
		);
	</insert>
	<!--  로그인 관리자 로그인 실패 저장 [E]-->
	
	<!--  로그인 관리자 로그아웃 저장 [S]-->
	<insert id="insertAdminLogOutLog" parameterType="AdminDTO">
		/* AdminLogin_SQL.insertAdminLogOutLog */
		INSERT INTO TB_ADMIN_LOGIN_LOG_INFO (
				   LOGIN_LOG_ID
			     , LOGIN_ADMIN_ID
			     , LOGIN_LOG_ADMIN_IP
			     , LOGIN_LOG_LOGIN_GB
			     , LOGIN_LOG_CN
			     , REG_DT
			     , UPD_DT 
		) VALUES (
				   ( SELECT FN_GET_UNIQUE_KEY() )
				 , #{adminId}
				 , #{adminIp}
				 , 'N'
				 , 'LOGOUT'
				 , NOW()
				 , NOW()
		);
	</insert>
	<!--  로그인 관리자 로그아웃 저장 [E]-->
	
	<!--  로그인 관리자 비밀번호 설정 [S]-->
	<update id="updateAdminLoginPwSet" parameterType="AdminDTO">
		/* AdminLogin_SQL.updateAdminLoginPwSet */
		UPDATE TB_ADMIN_INFO 
			 SET ADMIN_PW = #{adminPw}
		 WHERE 1=1
		     AND ADMIN_NO = #{adminNo}
			 AND ADMIN_ID = #{adminId}
			 AND ADMIN_DEL_YN = 'N';
	</update>
	<!--  로그인 관리자 비밀번호 설정 [E]-->
</mapper>