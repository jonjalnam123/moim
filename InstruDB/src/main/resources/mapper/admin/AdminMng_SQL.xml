<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.inst.project.admin.service.impl.AdminMngMapper">

	<!-- 관리자 공통코드 1레벨 조회 [S]  -->
	<select id="selectCommList" resultType="AdminCommDTO">
		/*AdminMng_SQL.selectCommList*/
		SELECT COMM_ID
				 , COMM_P_ID
				 , COMM_GROUP_CD
				 , COMM_NM
				 , COMM_USE_YN
				 , COMM_CN
				 , COMM_SORT_NO
				 , COMM_CD
				 , COMM_LVL
				 , COMM_DEL_YN
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_COMMON_INFO
		WHERE 1=1
		    AND COMM_DEL_YN = 'N'
		    AND COMM_LVL = 0
		ORDER BY COMM_SORT_NO
	</select>
	<!-- 관리자 공통코드 1레벨 조회 [E]  -->
	
	<!-- 관리자 공통코드 2레벨 조회 [S]  -->
	<select id="selectCommList2" resultType="AdminCommDTO">
		/*AdminMng_SQL.selectCommList2*/
		SELECT COMM_ID
				 , COMM_P_ID
				 , COMM_GROUP_CD
				 , COMM_NM
				 , COMM_USE_YN
				 , COMM_CN
				 , COMM_SORT_NO
				 , COMM_CD
				 , COMM_LVL
				 , COMM_DEL_YN
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_COMMON_INFO
		WHERE 1=1
		    AND COMM_DEL_YN = 'N'
		    AND COMM_LVL = 1
		 ORDER BY COMM_SORT_NO
	</select>
	<!-- 관리자 공통코드 2레벨 조회 [E]  -->
	
	<!-- 관리자 공통코드 상세 조회 [S] -->
	<select id="adminCommSelect" parameterType="AdminCommDTO" resultType="AdminCommDTO">
		/*AdminMng_SQL.adminCommSelect*/
		SELECT COMM_ID
				 , COMM_P_ID
				 , ( SELECT COMM_NM FROM TB_COMMON_INFO WHERE COMM_ID = #{commPId} ) AS COMM_P_NM
				 , COMM_GROUP_CD
				 , COMM_NM
				 , COMM_USE_YN
				 , COMM_CN
				 , COMM_SORT_NO
				 , COMM_CD
				 , COMM_LVL
				 , COMM_DEL_YN
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_COMMON_INFO
		WHERE 1=1
		    AND COMM_ID = #{commId}
		    AND COMM_DEL_YN = 'N'
	</select>
	<!-- 관리자 공통코드 상세 조회 [E] -->
	
	<!-- 관리자 공통코드 저장 [S] -->
	<insert id="adminCommReg" parameterType="AdminCommDTO">
		/*AdminMng_SQL.adminCommReg*/
		INSERT INTO TB_COMMON_INFO (
		   	  COMM_ID
			, COMM_P_ID
			, COMM_GROUP_CD
			, COMM_NM
			, COMM_USE_YN
			, COMM_CN
			, COMM_SORT_NO
			, COMM_CD
			, COMM_LVL
			, COMM_DEL_YN
			, REG_ID
			, REG_DT
			, UPD_ID
			, UPD_DT
		) VALUES ( 
			  (SELECT FN_GET_UNIQUE_KEY())
			, #{commPId}
			, #{commGroupCd}
			, #{commNm}
			, #{commUseYn}
			, #{commCn}
			, #{commSortNo}
			, #{commCd}
			, #{commLvl}
			, 'N'
			, #{regId}
			, NOW()
			, #{updId}
			, NOW()
		)
	</insert>
	<!-- 관리자 공통코드 저장 [E] -->
	
	<!-- 관리자 공통코드 수정 [S] -->
	<update id="adminCommUpd" parameterType="AdminCommDTO">
  		/*AdminMng_SQL.adminCommUpd*/
	  	UPDATE TB_COMMON_INFO
	     	 SET COMM_GROUP_CD	= #{commGroupCd}
				 , COMM_NM			= #{commNm}
				 , COMM_USE_YN		= #{commUseYn}
				 , COMM_CN			= #{commCn}
				 , COMM_SORT_NO	= #{commSortNo}
				 , COMM_CD			= #{commCd}
				 , COMM_LVL			= #{commLvl}
				 , UPD_ID				= #{updId}
				 , UPD_DT				= NOW()
	     WHERE COMM_ID = #{commId} 
	</update>
	<!-- 관리자 공통코드 수정 [E] -->
	
	<!-- 관리자 공통코드 삭제 [S] -->
	<update id="adminCommDel" parameterType="AdminCommDTO">
  		/*AdminMng_SQL.adminMenuDel*/
	  	UPDATE TB_COMMON_INFO
	     	 SET COMM_DEL_YN = 'Y'
	   	 WHERE COMM_ID   = #{commId} 
	   	 <if test="commPId == null or commPId == ''">
	   	 	OR COMM_P_ID = #{commId}
	   	 </if>
	</update>
	<!-- 관리자 공통코드 삭제 [E] -->
	
	<!-- 관리자 메뉴 1레벨 조회 [S] -->
	<select id="selectMenuList" resultType="AdminMenuDTO">
		/*AdminMng_SQL.selectMenuList*/
		SELECT MENU_ID
				 , MENU_P_ID
				 , MENU_NM
				 , MENU_USE_YN
				 , MENU_DEL_YN
				 , MENU_CN
				 , MENU_URL
				 , MENU_LVL
				 , MENU_SORT
 				 , MENU_DEPT_CD
				 , MENU_TEAM_CD
				 , MENU_POSITION_CD
				 , MENU_ICON
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_ADMIN_MENU_INFO
		WHERE 1=1
		    AND MENU_DEL_YN = 'N'
		    AND MENU_LVL = 0
		ORDER BY MENU_SORT
	</select>
	<!-- 관리자 메뉴 1레벨 조회 [E] -->
	
	<!-- 관리자 메뉴 2레벨 조회 [S] -->
	<select id="selectMenuList2" resultType="AdminMenuDTO">
		/*AdminMng_SQL.selectMenuList2*/
		SELECT MENU_ID
				 , MENU_P_ID
				 , MENU_NM
				 , MENU_USE_YN
				 , MENU_DEL_YN
				 , MENU_CN
				 , MENU_URL
				 , MENU_LVL
				 , MENU_SORT
				 , MENU_DEPT_CD
				 , MENU_TEAM_CD
				 , MENU_POSITION_CD
				 , MENU_ICON
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_ADMIN_MENU_INFO
		WHERE 1=1
		    AND MENU_DEL_YN = 'N'
		    AND MENU_LVL = 1
		 ORDER BY MENU_SORT
	</select>
	<!-- 관리자 메뉴 2레벨 조회 [E] -->
	
	<!-- 관리자 메뉴 상세 조회 [S] -->
	<select id="adminMenuSelect" parameterType="AdminMenuDTO" resultType="AdminMenuDTO">
		/*AdminMng_SQL.adminMenuSelect*/
		SELECT MENU_ID
				 , MENU_P_ID
				 , ( SELECT MENU_NM FROM TB_ADMIN_MENU_INFO WHERE MENU_ID = #{menuPId} ) AS MENU_P_NM
				 , MENU_NM
				 , MENU_USE_YN
				 , MENU_DEL_YN
				 , MENU_CN
				 , MENU_URL
				 , MENU_LVL
				 , MENU_SORT
				 , MENU_DEPT_CD
				 , MENU_TEAM_CD
				 , MENU_POSITION_CD
				 , MENU_ICON
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_ADMIN_MENU_INFO
		WHERE 1=1
		    AND MENU_ID = #{menuId}
		    AND MENU_DEL_YN = 'N'
	</select>
	<!-- 관리자 메뉴 상세 조회 [E] -->
	
	<!-- 관리자 메뉴 상세조회 결과로 부서코드 조회 [S] -->
	<select id="adminMenuDeptCdSelect" parameterType="string" resultType="map">
	    SELECT ADMIN_UNIT_CD as cd
				 , ADMIN_UNIT_NM as text
	      FROM TB_ADMIN_UNIT_INFO
	    WHERE 1=1
	        AND ADMIN_UNIT_CD = ANY (STRING_TO_ARRAY(#{menuDeptCd}, ','))
	    	AND ADMIN_UNIT_USE_YN = 'Y'
		    AND ADMIN_UNIT_DEL_YN = 'N' 
	</select>
	<!-- 관리자 메뉴 상세조회 결과로 부서코드 조회 [E] -->
	
	<!-- 관리자 메뉴 저장 [S] -->
	<insert id="adminMenuReg" parameterType="AdminMenuDTO">
		/*AdminMng_SQL.adminMenuReg*/
		INSERT INTO TB_ADMIN_MENU_INFO (
			  MENU_ID
			, MENU_P_ID
			, MENU_NM
			, MENU_URL
			, MENU_USE_YN
			, MENU_DEL_YN
			, MENU_CN
			, MENU_LVL
			, MENU_SORT
			, MENU_DEPT_CD
			, MENU_TEAM_CD
			, MENU_POSITION_CD
			, MENU_ICON
			, REG_ID
			, REG_DT
			, UPD_ID
			, UPD_DT
		) VALUES ( 
			  (SELECT FN_GET_UNIQUE_KEY())
			, #{menuPId}
			, #{menuNm}
			, #{menuUrl}
			, #{menuUseYn}
			, 'N'
			, #{menuCn}
			, #{menuLvl}
			, #{menuSort}
			, #{menuDeptCd}
			, #{menuTeamCd}
			, #{menuPositionCd}
			, #{menuIcon}
			, #{regId}
			, NOW()
			, #{updId}
			, NOW()
		)
	</insert>
	<!-- 관리자 메뉴 저장 [E] -->
	
	<!-- 관리자 메뉴 수정 [S] -->
	<update id="adminMenuUpd" parameterType="AdminMenuDTO">
  		/*AdminMng_SQL.adminMenuDel*/
	  	UPDATE TB_ADMIN_MENU_INFO
	     	 SET MENU_NM 				= #{menuNm}
				 , MENU_URL				= #{menuUrl}
				 , MENU_USE_YN			= #{menuUseYn}
				 , MENU_CN					= #{menuCn}
				 , MENU_LVL				= #{menuLvl}
				 , MENU_SORT				= #{menuSort}
				 , MENU_DEPT_CD		= #{menuDeptCd}
				 , MENU_TEAM_CD		= #{menuTeamCd}
				 , MENU_POSITION_CD	= #{menuPositionCd}
				 , MENU_ICON				= #{menuIcon}
				 , UPD_ID					= #{updId}
				 , UPD_DT					= NOW()
	   	 WHERE MENU_ID = #{menuId} 
	</update>
	<!-- 관리자 메뉴 수정 [E] -->
	
	<!-- 관리자 메뉴 삭제 [S] -->
	<update id="adminMenuDel" parameterType="AdminMenuDTO">
  		/*AdminMng_SQL.adminMenuDel*/
	  	UPDATE TB_ADMIN_MENU_INFO
	     	 SET MENU_DEL_YN = 'Y'
	   	 WHERE MENU_ID   = #{menuId} 
 	   	 <if test="menuPId == null or menuPId == ''">
	   	 	  OR MENU_P_ID = #{menuId}
	   	 </if>
	</update>
	<!-- 관리자 메뉴 삭제 [E] -->
	
	<!-- 관리자 유닛 조회 [S] -->
	<select id="selectUnitAllList" resultType="AdminUnitDTO">
		/*AdminMng_SQL.selectUnitAllList*/ 
		SELECT ADMIN_UNIT_ID
				  , ADMIN_UNIT_P_ID
				  , ADMIN_UNIT_CD
				  , ADMIN_UNIT_NM
				  , ADMIN_UNIT_LVL
				  , ADMIN_UNIT_SORT_NO
				  , ADMIN_UNIT_USE_YN
				  , ADMIN_UNIT_DEL_YN
				  , REG_ID
				  , REG_DT
				  , UPD_ID
				  , UPD_DT
		   FROM TB_ADMIN_UNIT_INFO
		 WHERE 1=1
		     AND ADMIN_UNIT_USE_YN = 'Y'
		     AND ADMIN_UNIT_DEL_YN = 'N'
		 ORDER BY ADMIN_UNIT_LVL
	</select>
	<!-- 관리자 유닛 조회 [E] -->
	
	<!-- 관리자 유닛 1레벨 조회 [S] -->
	<select id="selectUnitList" resultType="AdminUnitDTO">
		/*AdminMng_SQL.selectUnitList*/
		SELECT ADMIN_UNIT_ID
				 , ADMIN_UNIT_P_ID
				 , ADMIN_UNIT_CD
				 , ADMIN_UNIT_NM
				 , ADMIN_UNIT_LVL
				 , ADMIN_UNIT_SORT_NO
				 , ADMIN_UNIT_USE_YN
				 , ADMIN_UNIT_DEL_YN
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_ADMIN_UNIT_INFO
		WHERE 1=1
		    AND ADMIN_UNIT_DEL_YN = 'N'
		    AND ADMIN_UNIT_LVL = 0
		 ORDER BY ADMIN_UNIT_SORT_NO
	</select>
	<!-- 관리자 유닛 1레벨 조회 [E] -->
	
	<!-- 관리자 유닛 2레벨 조회 [S] -->
	<select id="selectUnitList2" resultType="AdminUnitDTO">
		/*AdminMng_SQL.selectUnitList2*/
		SELECT ADMIN_UNIT_ID
				 , ADMIN_UNIT_P_ID
				 , ADMIN_UNIT_CD
				 , ADMIN_UNIT_NM
				 , ADMIN_UNIT_LVL
				 , ADMIN_UNIT_SORT_NO
				 , ADMIN_UNIT_USE_YN
				 , ADMIN_UNIT_DEL_YN
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_ADMIN_UNIT_INFO
		WHERE 1=1
		    AND ADMIN_UNIT_DEL_YN = 'N'
		    AND ADMIN_UNIT_LVL = 1
		 ORDER BY ADMIN_UNIT_SORT_NO
	</select>
	<!-- 관리자 유닛 2레벨 조회 [E] -->
	
	<!-- 관리자 유닛 3레벨 조회 [S] -->
	<select id="selectUnitList3" resultType="AdminUnitDTO">
		/*AdminMng_SQL.selectUnitList3*/
		SELECT ADMIN_UNIT_ID
				 , ADMIN_UNIT_P_ID
				 , ADMIN_UNIT_CD
				 , ADMIN_UNIT_NM
				 , ADMIN_UNIT_LVL
				 , ADMIN_UNIT_SORT_NO
				 , ADMIN_UNIT_USE_YN
				 , ADMIN_UNIT_DEL_YN
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_ADMIN_UNIT_INFO 
		WHERE 1=1
		    AND ADMIN_UNIT_DEL_YN = 'N'
		    AND ADMIN_UNIT_LVL = 2
		 ORDER BY ADMIN_UNIT_SORT_NO  
	</select>
	<!-- 관리자 유닛 3레벨 조회 [E] -->
	
	<!-- 관리자 부서 상세 조회 [S] -->
	<select id="adminUnitSelect" parameterType="AdminUnitDTO" resultType="AdminUnitDTO">
		/*AdminMng_SQL.adminUnitSelect*/
		SELECT ADMIN_UNIT_ID
				 , ADMIN_UNIT_NM
				 , ADMIN_UNIT_P_ID
				 , ( SELECT ADMIN_UNIT_NM FROM TB_ADMIN_UNIT_INFO WHERE ADMIN_UNIT_ID = #{adminUnitPId} ) AS ADMIN_UNIT_P_NM
				 , ADMIN_UNIT_CD
				 , ADMIN_UNIT_LVL
				 , ADMIN_UNIT_SORT_NO
				 , ADMIN_UNIT_USE_YN
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		  FROM TB_ADMIN_UNIT_INFO
		WHERE 1=1
		    AND ADMIN_UNIT_ID = #{adminUnitId}
		    AND ADMIN_UNIT_DEL_YN = 'N'
	</select>
	<!-- 관리자 부서 상세 조회 [E] -->

	<!-- 관리자 부서 등록 [S] -->
	<insert id="adminUnitReg" parameterType="AdminUnitDTO">
		/*AdminMng_SQL.adminMenuReg*/
		INSERT INTO TB_ADMIN_UNIT_INFO (
			  ADMIN_UNIT_ID
			, ADMIN_UNIT_NM
			, ADMIN_UNIT_P_ID
			, ADMIN_UNIT_CD
			, ADMIN_UNIT_LVL
			, ADMIN_UNIT_SORT_NO
			, ADMIN_UNIT_CN
			, ADMIN_UNIT_USE_YN
			, ADMIN_UNIT_DEL_YN
			, REG_ID
			, REG_DT
			, UPD_ID
			, UPD_DT
		) VALUES ( 
			  (SELECT FN_GET_UNIQUE_KEY())
			, #{adminUnitNm}
			, #{adminUnitPId}
			, #{adminUnitCd}
			, #{adminUnitLvl}
			, #{adminUnitSortNo}
			, #{adminUnitCn}
			, #{adminUnitUseYn}
			, 'N'
			, #{regId}
			, NOW()
			, #{updId}
			, NOW()
		)
	</insert>
	<!-- 관리자 부서 등록 [E] -->
	
	<!-- 관리자 부서 수정 [S] -->
	<update id="adminUnitUpd" parameterType="AdminUnitDTO">
  		/*AdminMng_SQL.adminUnitUpd*/
	  	UPDATE TB_ADMIN_UNIT_INFO
	     	 SET ADMIN_UNIT_NM 			= #{adminUnitNm}
				 , ADMIN_UNIT_CD			= #{adminUnitCd}
				 , ADMIN_UNIT_LVL			= #{adminUnitLvl}
				 , ADMIN_UNIT_SORT_NO	= #{adminUnitSortNo}
				 , ADMIN_UNIT_CN			= #{adminUnitCn}
				 , ADMIN_UNIT_USE_YN		= #{adminUnitUseYn}
				 , UPD_ID						= #{updId}
				 , UPD_DT						= NOW()
	   	 WHERE ADMIN_UNIT_ID = #{adminUnitId} 
	</update>
	<!-- 관리자 부서 수정 [E] -->

	<!-- 관리자 부서 삭제 [S] -->
	<update id="adminUnitDel" parameterType="AdminUnitDTO">
  		/*AdminMng_SQL.adminUnitDel*/
	  	UPDATE TB_ADMIN_UNIT_INFO
	     	 SET ADMIN_UNIT_DEL_YN = 'Y'
	   	 WHERE ADMIN_UNIT_ID   = #{adminUnitId} 
 	   	 <if test="adminUnitPId == null or adminUnitPId == ''">
	   	 	  OR ADMIN_UNIT_P_ID = #{adminUnitPId}
	   	 </if>
	</update>
	<!-- 관리자 부서 삭제 [E] -->
	
	<!-- 관리자 조회 [S] -->
	<select id="selectAdminUser" resultType="AdminDTO">
		/*AdminMng_SQL.adminUnitSelect*/
		SELECT ADMIN_NO
				 , ADMIN_ID
				 , ADMIN_PW
				 , ADMIN_NM
				 , ADMIN_POSITION_CD
				 , ADMIN_PH
				 , ADMIN_POST_CD
				 , ADMIN_ADDRESS
				 , ADMIN_D_ADDRESS
				 , ADMIN_DEL_YN
				 , ADMIN_DEPT_CD
				 , ADMIN_TEAM_CD
				 , ADMIN_CN
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		FROM TB_ADMIN_INFO
	</select>
	<!-- 관리자 조회 [E] -->
	
	<!-- 관리자 부서 상세 조회 [S] -->
	<resultMap id="adminTeamMap" type="map">
	  <result column="ADMIN_UNIT_ID" property="adminUnitId"/>
	  <result column="ADMIN_UNIT_NM" property="adminUnitNm"/>
	  <result column="ADMIN_UNIT_CD" property="adminUnitCd"/>
	</resultMap>

	<select id="selectAdminTeamList" parameterType="String" resultMap="adminTeamMap">
		/*AdminMng_SQL.selectAdminTeamList*/
		SELECT ADMIN_UNIT_ID 
				 , ADMIN_UNIT_NM
				 , ADMIN_UNIT_CD
		  FROM TB_ADMIN_UNIT_INFO
		WHERE 1=1
		    AND ADMIN_UNIT_P_ID = #{adminUnitId}
		    AND ADMIN_UNIT_LVL = '1'
		    AND ADMIN_UNIT_DEL_YN = 'N'
	ORDER BY ADMIN_UNIT_SORT_NO ASC
	</select>
	
	<select id="selectAdminPositionList" parameterType="String" resultMap="adminTeamMap">
		/*AdminMng_SQL.selectAdminPositionList*/
		SELECT ADMIN_UNIT_ID 
				 , ADMIN_UNIT_NM
				 , ADMIN_UNIT_CD
		  FROM TB_ADMIN_UNIT_INFO
		WHERE 1=1
		    AND ADMIN_UNIT_P_ID = #{adminUnitId}
		    AND ADMIN_UNIT_LVL = '2'
		    AND ADMIN_UNIT_DEL_YN = 'N'
    ORDER BY ADMIN_UNIT_SORT_NO ASC
	</select>
	<!-- 관리자 부서 상세 조회 [E] -->
	
	<!-- 관리자 관리자 정보 조회 [S] -->
	<select id="selectAdminUserInfo" resultType="AdminDTO">
		/*AdminMng_SQL.selectAdminUserInfo*/
		SELECT ADMIN_NO
				 , ADMIN_ID
				 , ADMIN_PW
				 , ADMIN_NM
				 , ADMIN_POSITION_CD
				 , ADMIN_PH
				 , ADMIN_POST_CD
				 , ADMIN_ADDRESS
				 , ADMIN_D_ADDRESS
				 , ADMIN_DEL_YN
				 , ADMIN_DEPT_CD
				 , ADMIN_TEAM_CD
				 , ADMIN_CN
				 , REG_ID
				 , REG_DT
				 , UPD_ID
				 , UPD_DT
		FROM TB_ADMIN_INFO
	  WHERE 1=1 
	      AND ADMIN_NO = #{adminNo}
	      AND ADMIN_ID = #{adminId}
	</select>
	<!-- 관리자 관리자 정보 조회 [E] -->
	
</mapper>